<div data-ng-controller="DomainOperationUpdateCtrl as ctrl">
    <div data-wizard
         data-wizard-on-cancel="resetAction"
         data-wizard-on-finish="updateOperation"
         data-wizard-title="i18n.domains_operations_update_title">

        <div data-wizard-step
             data-wizard-step-valid="ctrl.updateOperationForm.$valid && ctrl.canContinue">

            <p>
                <span data-i18n-static="domains_operations_update_comment"></span>
                <em data-ng-bind="::ctrl.operation.comment"></em>
            </p>

            <div class="text-center" data-ng-if="ctrl.loading">
                <oui-spinner></oui-spinner>
            </div>

            <div data-ng-if="!ctrl.loading">

                <form class="form-horizontal" name="ctrl.updateOperationForm">

                    <div data-ng-if="ctrl.args.length > 0">
                        <p data-ng-bind-html="tr('domains_operations_update_info', [tr('domains_operations_nicOperation_' + ctrl.operation['function']), ctrl.operation.domain])"></p>
                        <hr>
                        <div class="form-group" data-ng-repeat="arg in ctrl.args track by $index">
                            <div data-ng-switch="arg.type">
                                <div data-ng-switch-when="string">
                                    <label class="control-label col-md-4" for="arg-{{$index}}"
                                           data-ng-bind="arg.keyTranslation || arg.description">
                                    </label>
                                    <div class="col-md-7">
                                        <input type="text" class="oui-input" name="arg-{{$index}}" id="arg-{{$index}}"
                                               data-ng-if="!arg.acceptedValues"
                                               data-ng-model="arg.value"
                                               data-ng-required>
                                        <div class="oui-select mb-0" data-ng-if="arg.acceptedValues && arg.acceptedValues.length > 1">
                                            <select class="oui-select__input" name="arg-{{$index}}" id="arg-{{$index}}"
                                                    data-ng-model="arg.value"
                                                    data-ng-options="operation for operation in arg.acceptedValues track by operation">
                                            </select>
                                            <span class="oui-icon oui-icon-chevron-down" aria-hidden="true"></span>
                                        </div>
                                    </div>
                                </div>

                                <div class="mt-1 text-center" data-ng-switch-when="/me/contact">
                                    <span data-i18n-static="domains_operations_update_nicowner"></span>
                                    <a target="_blank" title="{{::tr('domains_operations_update_nicowner_click_' + arg.key) + ' (' + i18n.core_new_window + ')'}}"
                                       data-ng-href="{{'#/useraccount/contact/' + arg.value + '/' + (arg.fields.length ? ctrl.constructor.getNicParams(arg) : '')}}">
                                        <span data-ng-bind="tr('domains_operations_update_nicowner_click_' + arg.key)"></span>
                                        <span class="fa fa-external-link" aria-hidden="true"></span>
                                    </a>
                                </div>

                                <div data-ng-switch-when="/me/document">
                                    <div class="row">
                                        <div class="col-md-6">
                                            <strong data-i18n-static="domains_operations_update_document_select_file"></strong>
                                        </div>
                                        <div class="col-md-6" data-ng-if="!ctrl.viewMode[arg.key]">
                                            <input type="file" accept="{{ctrl.constraints[arg.key].acceptedFormats}}"
                                                   data-ng-model="ctrl.filesModel[$index]"
                                                   data-ng-multiple="true"
                                                   data-ng-required="true"
                                                   data-max-size="{{ctrl.constraints[arg.key].maximumSize}}"
                                                   data-ovh-disable-reader="true"
                                                   data-ovh-filereader="ctrl.files[$index]"
                                                   data-ovh-filereader-action="ctrl.upload(ctrl.filesModel[$index], arg)">
                                            <button class="btn btn-icon ml-1" type="button"
                                                    data-ng-click="ctrl.viewMode[arg.key] = true"
                                                    data-ng-if="ctrl.previousValue[arg.key] && !ctrl.viewMode[arg.key]">
                                                <span class="fa fa-times" aria-hidden="true"></span>
                                            </button>
                                            <span class="text-danger"
                                                  data-i18n-static="domains_operations_update_document_file_invalid"
                                                  data-ng-if="ctrl.filesModel[$index].uploadError"></span>
                                        </div>
                                    </div>

                                    <div class="row">
                                        <div class="col-md-6">
                                            <strong data-i18n-static="domains_operations_update_document_description"></strong>
                                        </div>
                                        <div class="col-md-6" data-ng-bind="arg.description"></div>
                                    </div>

                                    <div class="row" data-ng-if="ctrl.viewMode[arg.key]">
                                        <div class="col-md-6">
                                            <strong data-i18n-static="domains_operations_update_document_exist"></strong>
                                        </div>
                                        <div class="col-md-6">
                                            <a data-ng-href="{{ctrl.documents[arg.value].getUrl}}" title="{{ctrl.constraints[arg.key].getUrl}} {{::core_new_window}}" target="_blank">
                                                <span data-i18n-static="domains_operations_update_document_exist"></span>
                                                <span data-i18n-static="domains_operations_update_document_expired" data-ng-if="ctrl.documents[arg.value].expirationDate"></span>
                                                <span data-ng-bind="(ctrl.documents[arg.value].expirationDate | date:'short') || '-'" data-ng-if="ctrl.documents[arg.value].expirationDate"></span>
                                                <span data-ng-if="ctrl.documents[arg.value].expirationDate">)</span>
                                                <span class="fa fa-external-link" aria-hidden="true"></span>
                                            </a>
                                            <button class="btn btn-icon" type="button"
                                                    data-ng-click="ctrl.viewMode[arg.key] = false"
                                                    data-uib-tooltip="{{tr('domains_operations_update_document_edit')}}">
                                                <span class="oui-icon oui-icon-pen_line" aria-hidden="true"></span>
                                            </button>
                                        </div>
                                    </div>

                                    <div class="row" data-ng-if="ctrl.constraints[arg.key].template">
                                        <div class="col-md-6">
                                            <strong data-i18n-static="domains_operations_update_document_template"></strong>
                                        </div>
                                        <div class="col-md-6">
                                            <a data-ng-href="{{ctrl.constraints[arg.key].template}}" title="{{ctrl.constraints[arg.key].template}} {{::core_new_window}}" target="_blank">
                                                <span data-i18n-static="domains_operations_update_document_link"></span>
                                                <span class="fa fa-external-link" aria-hidden="true"></span>
                                            </a>
                                        </div>
                                    </div>
                                    <div class="row" data-ng-if="ctrl.constraints[arg.key].minimumSize">
                                        <div class="col-md-6">
                                            <strong data-i18n-static="domains_operations_update_document_min_size"></strong>
                                        </div>
                                        <div class="col-md-6" data-ng-bind="ctrl.constraints[arg.key].minimumSize | humanReadableSize: {base: 10}"></div>
                                    </div>
                                    <div data-ng-if="ctrl.constraints[arg.key].maximumSize" class="row">
                                        <div class="col-md-6">
                                            <strong data-i18n-static="domains_operations_update_document_max_size"></strong>
                                        </div>
                                        <div class="col-md-6" data-ng-bind="ctrl.constraints[arg.key].maximumSize | humanReadableSize: {base: 10}"></div>
                                    </div>
                                    <div class="row" data-ng-if="ctrl.constraints[arg.key].acceptedFormats !== '*'">
                                        <div class="col-md-6">
                                            <strong data-i18n-static="domains_operations_update_document_accept_format"></strong>
                                        </div>
                                        <div class="col-md-6" data-ng-bind="ctrl.constraints[arg.key].acceptedFormats"></div>
                                    </div>
                                </div>

                                <input type="text" class="form-control" name="arg-{{$index}}" id="arg-{{$index}}"
                                       data-ng-switch-default
                                       data-ng-model="arg.value"
                                       data-ng-required>
                            </div>
                        </div>
                        <hr>
                    </div>

                    <div class="col-md-offset-4" data-ng-if="ctrl.canContinue"
                        data-ng-init="ctrl.todoOperation = 'cancel'">

                        <oui-radio text="{{::tr('domains_operations_cancel_title')}}"
                                on-change="ctrl.todoOperation = 'cancel'"
                                model="ctrl.todoOperation"
                                disabled="!ctrl.operation.canCancel"
                                name="task-update"
                                value="'cancel'">                       
                        </oui-radio>  

                        <oui-radio text="{{::tr('domains_operations_relaunch_title')}}"
                            on-change="ctrl.todoOperation = 'relaunch'"
                            model="ctrl.todoOperation"
                            disabled="!ctrl.operation.canRelaunch"
                            name="task-update"
                            value="'relaunch'">                       
                        </oui-radio>

                        <oui-radio text="{{::tr('domains_operations_accelerate_title')}}"
                            on-change="ctrl.todoOperation = 'accelerate'"
                            model="ctrl.todoOperation"
                            disabled="!ctrl.operation.canAccelerate"
                            name="task-update"
                            value="'accelerate'">                       
                        </oui-radio>

                        <div class="alert alert-warning mt-4" role="alert"
                             data-i18n-static="domains_operations_accelerate_warning"
                             data-ng-if="ctrl.todoOperation === 'accelerate'">
                        </div>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
